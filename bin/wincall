#!/bin/bash
# Wrap commands for the Window Calls extension for GNOME Shell
# https://github.com/ickyicky/window-calls

function wincall {
  local method="$1"
  shift

  dbus-send --session --print-reply=literal \
    --dest=org.gnome.Shell \
    "/org/gnome/Shell/Extensions/Windows" \
    "org.gnome.Shell.Extensions.Windows.$method" \
    "$@"
}

case "$1" in
  list)
    count=$( wincall GetWorkspaceCount | awk '{ print $2 }' )
    echo "$count workspaces:"
    wincall GetWorkspaces | jq -c '.[]'
    for workspace in $(seq 0 $((count - 1)) ); do
      echo
      echo "Windows on workspace $workspace:"
      wincall GetWorkspaceWindows "uint32:$workspace" | jq -c '.[]'
    done
    ;;
  activate|close|maximize|minimize|unmaximize|unminimize)
    method=${1^}
    id=$( wincall List | jq "[.[] | select(.wm_class | test(\"$2\"; \"i\"))] | first | .id // empty" )

    if [ "$id" ]; then
      wincall "$method" "uint32:$id"
    else
      echo "Window not found: $2"
      exit 1
    fi
    ;;
  switch)
    wincall SwitchWorkspace "uint32:$2"
    ;;
  *)
    echo "Usage: wincall list"
    echo "       wincall switch <WORKSPACE>"
    echo "       wincall activate <WINDOW>"
    echo "       wincall close <WINDOW>"
    echo "       wincall maximize <WINDOW>"
    echo "       wincall minimize <WINDOW>"
    echo "       wincall unmaximize <WINDOW>"
    echo "       wincall unminimize <WINDOW>"
    exit 255
    ;;
esac
