#!/bin/bash

if pgrep -x bitwig-studio >/dev/null; then
  exec wmctrl -xa com.bitwig.BitwigStudio
fi

workspace=~/.var/app/com.bitwig.BitwigStudio/"Bitwig Studio"
if [ ! -L "$workspace" ] && [ -d /slack/sound/bitwig/workspace ]; then
  rm -rf "$workspace"
  ln -s /slack/sound/bitwig/workspace "$workspace"
fi

wmctrl -s 1

export PIPEWIRE_QUANTUM=192/48000

pw-jack overwitch &>/dev/null &
flatpak run com.bitwig.BitwigStudio "$@"
killall -9 overwitch 2>/dev/null

wmctrl -s 0
